# Flight Delay Prediction - MLOps Pipeline

AAI-540 MLOps Course - Group 1 Project

## Project Organization

This document describes how the project is organized. **Read this before making changes.**

---

## Folder Structure

```
aai540_group1/
├── README.md                    # This file - read first
├── requirements.txt
│
├── notebooks/                   # Jupyter notebooks (numbered for execution order)
│   ├── 01_data_ingestion/
│   ├── 02_feature_engineering/
│   ├── 03_training_and_evaluation/
│   ├── 04_inference/
│   └── archive/                 # Deprecated notebooks - do not use
│
├── scripts/                     # Python scripts for SageMaker jobs
├── config/                      # Configuration files
├── data/                        # Local data (not committed to git)
└── sql/                         # SQL queries (Athena)
```

### Naming Conventions

**Folders:** Use `XX_descriptive_name/` format where XX is a two-digit number indicating execution order.

**Notebooks:** Use `XX_descriptive_name.ipynb` format within each folder.
- `00_` = Setup/prerequisites (run once)
- `01_`, `02_`, ... = Sequential steps (run in order)

**Why numbering?** Notebooks often depend on outputs from previous notebooks. The numbering ensures correct execution order and makes dependencies clear.

**Examples:**
- `01_data_ingestion/01_setup_s3_and_ingest.ipynb` runs before `01_data_ingestion/02_create_athena_tables.ipynb`
- All of `02_feature_engineering/` should complete before starting `03_training_and_evaluation/`

### Adding New Files

| If you need to... | Put it in... | Name it... |
|-------------------|--------------|------------|
| Add a notebook for data work | `notebooks/01_data_ingestion/` | `XX_description.ipynb` |
| Add a notebook for features | `notebooks/02_feature_engineering/` | `XX_description.ipynb` |
| Add a notebook for training | `notebooks/03_training_and_evaluation/` | `XX_description.ipynb` |
| Add a notebook for deployment | `notebooks/04_inference/` | `XX_description.ipynb` |
| Deprecate a notebook | `notebooks/archive/` | Keep original name |
| Add a Python script | `scripts/` | `descriptive_name.py` |

---

## AWS Resource Naming

All AWS resources use the `aai540-group1` prefix. **Do not create resources with random names.**

### S3 Buckets

| Bucket | Purpose | Access |
|--------|---------|--------|
| `sagemaker-us-east-1-425709451100` | Shared data (read-only for most users) | Public team bucket |
| `sagemaker-us-east-1-786869526001` | Personal workspace | `sess.default_bucket()` |

### S3 Prefixes

All data lives under `aai540-group1/` prefix:

```
aai540-group1/
├── data/raw/                    # Raw source data
├── features/                    # Parquet feature files (train, val, test, prod)
├── training/                    # CSV files for SageMaker training
│   ├── raw-baseline/            # 6-feature variant
│   ├── engineered-no-target-encoding/  # 16-feature variant
│   └── engineered-baseline/     # 20-feature variant
├── models/                      # Model artifacts from training jobs
│   ├── raw-baseline/
│   └── engineered-no-target-encoding/
├── predictions/                 # Batch prediction outputs
└── inference/                   # Inference input files
```

**When adding new data:** Follow existing prefix structure. Use descriptive names with hyphens (not underscores).

### SageMaker Resources

| Resource Type | Naming Pattern | Example |
|---------------|----------------|---------|
| Model Package Group | `flight-delay-models` | (already created) |
| Training Jobs | Auto-generated by SageMaker | `sagemaker-xgboost-2026-...` |
| Endpoints | `flight-delay-{variant}` | `flight-delay-v2` |

---

## Notebook Guidelines

### Idempotency

**All notebook cells should be idempotent whenever possible.** This means running a cell multiple times produces the same result without errors or side effects.

**How to achieve idempotency:**

1. **S3 uploads:** Check if file exists before uploading
   ```python
   try:
       s3_client.head_object(Bucket=bucket, Key=key)
       print("Already exists, skipping")
   except ClientError:
       s3_client.upload_file(...)
   ```

2. **Resource creation:** Check if resource exists before creating
   ```python
   try:
       sm_client.describe_model_package_group(...)
       print("Already exists")
   except:
       sm_client.create_model_package_group(...)
   ```

3. **Directory creation:** Use `os.makedirs(path, exist_ok=True)`

**Known exceptions (not idempotent):**
- Training jobs: Each run creates a new job (this is expected)
- Model registration: Each run creates a new version (this is expected)

### Cell Structure

Each notebook should have:
1. **Markdown header:** Title, Purpose, Prerequisites
2. **Imports cell:** All imports in one place
3. **Configuration cell:** Buckets, prefixes, constants
4. **Execution cells:** One logical step per cell
5. **Markdown summary:** Results and next steps

---

## Current Status

| Phase | Folder | Status |
|-------|--------|--------|
| Data Ingestion | `01_data_ingestion/` | Complete |
| Feature Engineering | `02_feature_engineering/` | Complete |
| Training & Evaluation | `03_training_and_evaluation/` | Complete |
| Inference/Deployment | `04_inference/` | Pending |

---

## License

Academic project - AAI-540 MLOps Course, University of San Diego

